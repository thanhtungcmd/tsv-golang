#name: Go CI/CD - Balheh
#
#on:
#  push:
#    branches: [ "main" ]
#  pull_request:
#    branches: [ "main" ]
#
#jobs:
#  build:
#    runs-on: ubuntu-latest
#
#    steps:
#      - name: Checkout repository
#        uses: actions/checkout@v4
#
#      - name: Set up Go
#        uses: actions/setup-go@v5
#        with:
#          go-version: '1.25'
#
#      - name: Verify Go version
#        run: go version
#
#      - name: Download dependencies
#        run: go mod tidy
#
#      - name: Build static Linux binary
#        run: |
#          mkdir -p build
#          CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build \
#            -tags netgo \
#            -ldflags="-s -w -extldflags=-static" \
#            -o build/app main.go
#          echo "✅ Build complete."
#          file build/app
#
#      - name: Upload Go binary artifact
#        uses: actions/upload-artifact@v4
#        with:
#          name: go-app
#          path: build/app
#
#  deploy:
#    runs-on: ubuntu-latest
#    needs: build
#
#    steps:
#      - name: Download build artifact
#        uses: actions/download-artifact@v4
#        with:
#          name: go-app
#          path: build
#
#      - name: Save SSH KEY
#        run: |
#          echo "${{ secrets.LIGHTSAIL_KEY_PEM }}" > /tmp/lightsail_key.pem
#          chmod 600 /tmp/lightsail_key.pem
#
#      - name: Upload binary to Lightsail server
#        run: |
#          scp -i /tmp/lightsail_key.pem -o StrictHostKeyChecking=no build/app \
#            ${{ secrets.LIGHTSAIL_USER }}@${{ secrets.LIGHTSAIL_HOST }}:/home/${{ secrets.LIGHTSAIL_USER }}/projects/backend/app
#
#      - name: Restart backend container on Lightsail
#        run: |
#          ssh -o StrictHostKeyChecking=no -i /tmp/lightsail_key.pem ${{ secrets.LIGHTSAIL_USER }}@${{ secrets.LIGHTSAIL_HOST }} << 'EOF'
#            set -e
#            cd /home/${{ secrets.LIGHTSAIL_USER }}/projects
#
#            echo "👉 Stopping old backend container..."
#            docker compose stop backend || true
#
#            echo "🔁 Restarting backend container..."
#            docker compose up -d --force-recreate backend
#
#            echo "✅ Deployment completed successfully."
#          EOF
#
#      - name: Remove temporary SSH key
#        run: rm -f /tmp/lightsail_key.pem
